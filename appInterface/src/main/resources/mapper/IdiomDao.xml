<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.qin.dao.IdiomDao">


    <select id="findDetailById" resultType="cn.qin.vo.idiomVo.IdiomVo">

        select
            idiom.*,
            cdata.collection_id as collectionId
        from idiom
        left  join collection_data cdata on  cdata.object_id = idiom.idiom_id and  cdata.del_flag = 0
        and cdata.user_id = #{usrId}
        where idiom.del_flag = 0
        and idiom.idiom_id = #{idiomId}

    </select>
    <select id="findIdiomBySearchText"  resultType="cn.qin.vo.idiomVo.IdiomSearchVo">
        select
            idiom.idiom_id,
            idiom.idiom,
            idiom.spell
        from idiom
        where  idiom.abbreviation LIKE #{searchText} or idiom.idiom like #{searchText}
    </select>

    <select id="findRandomForSize"  resultType="cn.qin.vo.idiomVo.IdiomSearchVo">
        select
            idiom.idiom_id,
            idiom.idiom,
            idiom.spell
        from idiom
        ORDER BY RAND() LIMIT #{size}
    </select>

    <select id="findAllIdiomList"  resultMap="selectIdiomList">
        SELECT
            tag,
            #{pageSize} as sizet
        FROM idiom
        GROUP BY tag
        ORDER BY tag ASC
    </select>

    <resultMap id="selectIdiomList" type="cn.qin.vo.idiomVo.IdiomListVo">
        <result property="initial" column="tag" javaType="java.lang.String"/>
        <collection property="idioms"  ofType="cn.qin.vo.idiomVo.IdiomSearchVo"
                    javaType="java.util.ArrayList" select="fildIdiomSearchList"
                    column="{tag=tag,size=sizet}"/>
    </resultMap>

    <select id="fildIdiomSearchList"  resultType="cn.qin.vo.idiomVo.IdiomSearchVo" >
        select
            idiom.idiom_id,
            idiom.idiom,
            idiom.spell
        from idiom
        where  idiom.tag = #{tag} LIMIT  #{size}
    </select>

    <select id="findIdiomListByTag" resultType="cn.qin.vo.idiomVo.IdiomSearchVo">
        select
            idiom.*
        from idiom
        where idiom.tag = #{idiomVo.tag}
    </select>

    <select id="findIdiomDaily" resultType="cn.qin.vo.idiomVo.IdiomVo">
        select
            idiom.*,
            cdata.collection_id as collectionId
        from idiom
        left  join collection_data cdata on  cdata.object_id = idiom.idiom_id and  cdata.del_flag = 0
        ORDER BY RAND() LIMIT 1
    </select>

</mapper>